<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouTube íƒìƒ‰ê¸°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background-color: #fafafa;
        color: #333;
      }

      /* ì™¼ìª½ íŒ¨ë„ */
      .sidebar {
        width: 1000px;
        background-color: white;
        padding: 30px 40px;
        border-right: 1px solid #e5e5e5;
        overflow-y: auto;
        max-height: 100vh;
      }

      .sidebar-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 30px;
        color: #000;
      }

      /* API í‚¤ ì„¹ì…˜ */
      .api-section {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }

      .api-label {
        font-size: 12px;
        color: #999;
        min-width: 120px;
        font-weight: 600;
      }

      .api-input {
        flex: 1;
        padding: 10px 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 13px;
        font-family: monospace;
        min-width: 250px;
      }

      .btn-group {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-save {
        background-color: #ff4757;
        color: white;
        min-width: 60px;
      }

      .btn-save:hover {
        background-color: #ff3838;
      }

      .btn-delete {
        background-color: #e5e5e5;
        color: #666;
        min-width: 60px;
      }

      .btn-delete:hover {
        background-color: #d5d5d5;
      }

      /* ê²€ìƒ‰ ì„¹ì…˜ */
      .search-section {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }

      .search-label {
        font-size: 12px;
        color: #999;
        min-width: 50px;
        font-weight: 600;
      }

      .search-input {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        position: relative;
      }

      .search-container {
        position: relative;
        flex: 1;
      }

      .search-history-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 4px 4px;
        max-height: 200px;
        overflow-y: auto;
        display: none;
        z-index: 10;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .search-history-dropdown.active {
        display: block;
      }

      .history-item {
        padding: 10px 14px;
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        font-size: 13px;
        color: #666;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .history-item:hover {
        background-color: #f5f5f5;
      }

      .history-delete {
        background: none;
        border: none;
        color: #999;
        cursor: pointer;
        font-size: 12px;
        padding: 0 4px;
      }

      .history-delete:hover {
        color: #ff4757;
      }

      /* í•„í„° ì„¹ì…˜ - ì»¨í…Œì´ë„ˆ */
      .filters-wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .filter-section {
        display: flex;
        flex-direction: column;
      }

      .filter-title {
        font-size: 12px;
        font-weight: 700;
        color: #333;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .filter-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .filter-option {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s ease;
        user-select: none;
      }

      .filter-option:hover {
        background-color: #efefef;
        border-color: #ccc;
      }

      .filter-option input[type="radio"],
      .filter-option input[type="checkbox"] {
        cursor: pointer;
        accent-color: #4caf50;
        width: 14px;
        height: 14px;
      }

      .filter-option label {
        cursor: pointer;
        margin: 0;
        font-size: 13px;
      }

      .filter-option input:checked + label {
        font-weight: 600;
        color: #4caf50;
      }

      /* êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒìˆ˜ ë¹„ìœ¨ ì„¹ì…˜ */
      .engagement-section {
        grid-column: 1 / -1;
      }

      .engagement-title {
        font-size: 12px;
        font-weight: 700;
        color: #333;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .engagement-info {
        font-size: 11px;
        color: #999;
        margin-bottom: 12px;
        font-style: italic;
      }

      .engagement-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      /* ì €ì¥ëœ ê²€ìƒ‰ ì„¹ì…˜ */
      .saved-searches-section {
        margin-bottom: 30px;
      }

      .saved-searches-title {
        font-size: 12px;
        font-weight: 700;
        color: #333;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .saved-searches-controls {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .saved-search-name-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 12px;
      }

      .btn-save-search {
        padding: 8px 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-save-search:hover {
        background-color: #45a049;
      }

      .saved-searches-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .saved-search-item {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background-color: #e8f5e9;
        border: 1px solid #4caf50;
        border-radius: 20px;
        font-size: 12px;
        color: #2e7d32;
      }

      .saved-search-item-name {
        cursor: pointer;
        font-weight: 500;
        flex: 1;
      }

      .saved-search-item-name:hover {
        text-decoration: underline;
      }

      .saved-search-item-delete {
        background: none;
        border: none;
        color: #c62828;
        cursor: pointer;
        font-size: 14px;
        padding: 0 4px;
      }

      .saved-search-item-delete:hover {
        font-weight: bold;
      }

      .saved-searches-comparison {
        background-color: #f5f5f5;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 15px;
        margin-top: 12px;
        display: none;
        font-size: 12px;
      }

      .saved-searches-comparison.active {
        display: block;
      }

      .comparison-item {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 10px;
        padding: 10px;
        background-color: white;
        border-radius: 4px;
      }

      .comparison-stat {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
      }

      .comparison-stat-label {
        color: #666;
      }

      .comparison-stat-value {
        font-weight: 600;
        color: #333;
      }

      /* ì˜¤ë¥¸ìª½ ì»¨í…ì¸  ì˜ì—­ */
      .content {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 30px 40px;
        overflow-y: auto;
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 20px;
        flex-wrap: wrap;
      }

      .content-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }

      .controls-right {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .view-toggle {
        display: flex;
        gap: 4px;
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow: hidden;
      }

      .view-btn {
        padding: 8px 12px;
        border: none;
        background: white;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        color: #666;
        transition: all 0.2s ease;
      }

      .view-btn.active {
        background-color: #4caf50;
        color: white;
      }

      .view-btn:hover:not(.active) {
        background-color: #f5f5f5;
      }

      .sort-dropdown {
        padding: 8px 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 13px;
        background-color: white;
        cursor: pointer;
        min-width: 160px;
      }

      .btn-search {
        background-color: #4caf50;
        color: white;
        padding: 10px 24px;
        font-size: 13px;
        font-weight: 600;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn-search:hover {
        background-color: #45a049;
      }

      .btn-search:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      .btn-excel {
        background-color: #1abc9c;
        color: white;
        padding: 10px 24px;
        font-size: 13px;
        font-weight: 600;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-excel:hover {
        background-color: #16a085;
      }

      .btn-excel:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      .results-count {
        font-size: 13px;
        color: #999;
        margin-bottom: 20px;
      }

      .statistics-dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-card.views {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .stat-card.subscribers {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .stat-card.ratio {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .stat-card.count {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      }

      .stat-label {
        font-size: 11px;
        opacity: 0.9;
        margin-bottom: 8px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .stat-value {
        font-size: 18px;
        font-weight: 700;
      }

      /* íƒœê·¸ ë¶„ì„ ëŒ€ì‹œë³´ë“œ */
      .tag-analysis-dashboard {
        background-color: white;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        display: none;
      }

      .tag-analysis-dashboard.active {
        display: block;
      }

      .tag-analysis-title {
        font-size: 14px;
        font-weight: 700;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .tag-analysis-toggle {
        font-size: 12px;
        cursor: pointer;
        padding: 6px 12px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        color: #666;
        transition: all 0.2s ease;
      }

      .tag-analysis-toggle:hover {
        background-color: #efefef;
        border-color: #ccc;
      }

      .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
      }

      .tag-item {
        background-color: #f0f0f0;
        color: #333;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid #e0e0e0;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .tag-item:hover {
        background-color: #e8e8e8;
        border-color: #bbb;
        transform: scale(1.05);
      }

      .tag-frequency {
        font-weight: 600;
        color: #4caf50;
      }

      .tag-stats-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }

      .tag-stats-table thead {
        background-color: #f5f5f5;
        border-bottom: 1px solid #ddd;
      }

      .tag-stats-table th {
        padding: 10px;
        text-align: left;
        font-weight: 600;
        color: #333;
      }

      .tag-stats-table td {
        padding: 8px 10px;
        border-bottom: 1px solid #f0f0f0;
        color: #666;
      }

      .tag-stats-table tbody tr:hover {
        background-color: #fafafa;
      }

      /* ì¹´ë“œ ê·¸ë¦¬ë“œ */
      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 16px;
        flex: 1;
      }

      .results-grid.hidden {
        display: none;
      }

      /* í…Œì´ë¸” ë·° */
      .results-table-wrapper {
        flex: 1;
        overflow-x: auto;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        display: none;
      }

      .results-table-wrapper.active {
        display: block;
      }

      .results-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }

      .results-table thead {
        background-color: #f5f5f5;
        position: sticky;
        top: 0;
      }

      .results-table th {
        padding: 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 1px solid #e5e5e5;
        color: #333;
        white-space: nowrap;
      }

      .results-table td {
        padding: 12px;
        border-bottom: 1px solid #e5e5e5;
      }

      .results-table tbody tr:hover {
        background-color: #fafafa;
      }

      .table-thumbnail {
        width: 60px;
        height: 45px;
        object-fit: cover;
        border-radius: 4px;
      }

      .table-title {
        max-width: 250px;
        word-break: break-word;
      }

      .table-link {
        color: #4caf50;
        text-decoration: none;
        font-weight: 600;
      }

      .table-link:hover {
        text-decoration: underline;
      }

      .engagement-badge {
        display: block;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 10px;
        font-weight: 600;
        white-space: nowrap;
        margin-top: 8px;
        margin-bottom: 4px;
        width: fit-content;
      }

      .engagement-1 {
        background-color: #ffe5e5;
        color: #cc0000;
      }

      .engagement-2 {
        background-color: #ffe6cc;
        color: #ff6600;
      }

      .engagement-3 {
        background-color: #ffffcc;
        color: #ccaa00;
      }

      .engagement-4 {
        background-color: #ccffcc;
        color: #00aa00;
      }

      .engagement-5 {
        background-color: #ccffee;
        color: #009999;
      }

      /* ëŒ“ê¸€ ë¶„ì„ ëª¨ë‹¬ */
      .comments-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .comments-modal.active {
        display: flex;
      }

      .comments-modal-content {
        background-color: white;
        border-radius: 8px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        position: relative;
      }

      .comments-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e5e5e5;
      }

      .comments-modal-title {
        font-size: 14px;
        font-weight: 700;
        color: #333;
      }

      .comments-modal-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .comments-modal-close:hover {
        color: #333;
      }

      .comments-loading {
        text-align: center;
        padding: 20px;
        color: #999;
      }

      .comments-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
        padding: 10px;
        background-color: #f5f5f5;
        border-radius: 4px;
        font-size: 12px;
      }

      .comment-stat-item {
        text-align: center;
      }

      .comment-stat-label {
        color: #999;
        font-size: 10px;
        margin-bottom: 4px;
      }

      .comment-stat-value {
        font-weight: 700;
        font-size: 14px;
        color: #333;
      }

      .comments-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .comment-item {
        border: 1px solid #e5e5e5;
        border-radius: 4px;
        padding: 10px;
        background-color: #fafafa;
      }

      .comment-author {
        font-weight: 600;
        font-size: 12px;
        color: #333;
        margin-bottom: 4px;
      }

      .comment-text {
        font-size: 12px;
        color: #666;
        line-height: 1.4;
        margin-bottom: 6px;
        word-break: break-word;
      }

      .comment-meta {
        display: flex;
        gap: 12px;
        font-size: 11px;
        color: #999;
      }

      .comment-likes {
        display: flex;
        align-items: center;
        gap: 3px;
      }

      .comment-replies {
        display: flex;
        align-items: center;
        gap: 3px;
      }

      .btn-view-comments {
        padding: 4px 8px;
        font-size: 11px;
        background-color: #e8f5e9;
        border: 1px solid #4caf50;
        border-radius: 3px;
        color: #2e7d32;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-view-comments:hover {
        background-color: #c8e6c9;
      }

      /* ì±„ë„ ë¶„ì„ ëª¨ë‹¬ */
      .channel-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .channel-modal.active {
        display: flex;
      }

      .channel-modal-content {
        background-color: white;
        border-radius: 8px;
        max-width: 700px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        position: relative;
      }

      .channel-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e5e5e5;
      }

      .channel-modal-title {
        font-size: 16px;
        font-weight: 700;
        color: #333;
      }

      .channel-modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .channel-modal-close:hover {
        color: #333;
      }

      .channel-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
      }

      .channel-stat-box {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #4caf50;
      }

      .channel-stat-label {
        font-size: 12px;
        color: #999;
        margin-bottom: 6px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .channel-stat-value {
        font-size: 18px;
        font-weight: 700;
        color: #333;
      }

      .channel-description {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 15px;
        font-size: 13px;
        color: #666;
        line-height: 1.6;
        border: 1px solid #e5e5e5;
      }

      .channel-loading {
        text-align: center;
        padding: 30px;
        color: #999;
      }

      .btn-view-channel {
        padding: 4px 8px;
        font-size: 11px;
        background-color: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 3px;
        color: #1565c0;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-view-channel:hover {
        background-color: #bbdefb;
      }

      /* ì¹´ë“œ ë·° */
      .video-card {
        background-color: white;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
      }

      .video-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-4px);
      }

      .video-thumbnail {
        width: 100%;
        height: 130px;
        background-color: #e5e5e5;
        object-fit: cover;
        position: relative;
      }

      .video-duration {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 2px;
        font-size: 11px;
        font-weight: 600;
      }

      .video-info {
        padding: 12px;
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      .video-title {
        font-size: 12px;
        font-weight: 600;
        color: #000;
        margin-bottom: 6px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.4;
      }

      .video-channel {
        font-size: 11px;
        color: #666;
        margin-bottom: 8px;
      }

      .video-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
        margin-bottom: 8px;
        font-size: 11px;
        color: #999;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 3px;
      }

      .video-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 3px;
        margin-bottom: 8px;
      }

      .tag {
        background-color: #f0f0f0;
        color: #666;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 10px;
      }

      .video-link {
        display: inline-block;
        color: #4caf50;
        text-decoration: none;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        margin-top: auto;
      }

      .video-link:hover {
        text-decoration: underline;
      }

      /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
      .main-container {
        display: flex;
        min-height: 100vh;
      }

      .status {
        text-align: center;
        padding: 40px 20px;
        color: #999;
        font-size: 14px;
      }

      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #4caf50;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        background-color: #ff4757;
        color: white;
        padding: 12px 16px;
        border-radius: 4px;
        margin-bottom: 16px;
        font-size: 12px;
      }

      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #999;
        font-size: 14px;
      }

      /* ìŠ¤í¬ë¡¤ë°” */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #999;
      }

      @media (max-width: 1200px) {
        .sidebar {
          width: 100%;
          max-height: none;
          border-right: none;
          border-bottom: 1px solid #e5e5e5;
        }

        .content {
          padding: 20px;
        }

        .filters-wrapper {
          grid-template-columns: 1fr;
        }

        .results-grid {
          grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        }

        .main-container {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- ì™¼ìª½ íŒ¨ë„ -->
      <div class="sidebar">
        <div class="sidebar-title">í¬ë¦¬ì—ì´í‹°ë¸Œí—ˆë¸Œ</div>

        <!-- API í‚¤ ì„¹ì…˜ -->
        <div class="api-section">
          <div class="api-label">API í‚¤ (localStorage: yt_api_key)</div>
          <input type="password" class="api-input" id="apiKey" placeholder="AlzaSyC2XwmVlXjWO14-P-fRggwHUsklsn-KQt8" />
          <div class="btn-group">
            <button class="btn btn-delete" id="btnDelete">ì§€ìš°ê¸°</button>
            <button class="btn btn-save" id="btnSave">ì €ì¥</button>
          </div>
        </div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="search-section">
          <div class="search-label">ê²€ìƒ‰ì–´</div>
          <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="" />
            <div class="search-history-dropdown" id="searchHistory"></div>
          </div>
        </div>

        <!-- ì €ì¥ëœ ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="saved-searches-section">
          <div class="saved-searches-title">ğŸ’¾ ì €ì¥ëœ ê²€ìƒ‰</div>
          <div class="saved-searches-controls">
            <input type="text" class="saved-search-name-input" id="savedSearchName" placeholder="ê²€ìƒ‰ ì´ë¦„ ì…ë ¥" />
            <button class="btn-save-search" id="btnSaveSearch">ì €ì¥</button>
          </div>
          <div class="saved-searches-list" id="savedSearchesList"></div>
          <div class="saved-searches-comparison" id="savedSearchesComparison"></div>
        </div>

        <!-- í•„í„° ì„¹ì…˜ -->
        <div class="filters-wrapper">
          <!-- ê¸°ê°„ í•„í„° -->
          <div class="filter-section">
            <div class="filter-title">ê¸°ê°„ í•„í„°</div>
            <div class="filter-options">
              <label class="filter-option">
                <input type="radio" name="uploadPeriod" value="all" checked />
                <label>ì „ì²´</label>
              </label>
              <label class="filter-option">
                <input type="radio" name="uploadPeriod" value="1month" />
                <label>1ê°œì›”</label>
              </label>
              <label class="filter-option">
                <input type="radio" name="uploadPeriod" value="2months" />
                <label>2ê°œì›”</label>
              </label>
              <label class="filter-option">
                <input type="radio" name="uploadPeriod" value="6months" />
                <label>6ê°œì›”</label>
              </label>
              <label class="filter-option">
                <input type="radio" name="uploadPeriod" value="1year" />
                <label>1ë…„</label>
              </label>
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e5e5;">
              <label class="filter-option">
                <input type="checkbox" id="showVPH" />
                <label>VPH í‘œì‹œ</label>
              </label>
            </div>
          </div>

          <!-- ê¸¸ì´ í•„í„° -->
          <div class="filter-section">
            <div class="filter-title">ê¸¸ì´ í•„í„°</div>
            <div class="filter-options">
              <label class="filter-option">
                <input type="radio" name="videoLength" value="all" checked />
                <label>ì „ì²´</label>
              </label>
              <label class="filter-option">
                <input type="radio" name="videoLength" value="short" />
                <label>ìˆí¼(â‰¤3ë¶„)</label>
              </label>
              <label class="filter-option">
                <input type="radio" name="videoLength" value="long" />
                <label>ë¡±í¼(>3ë¶„)</label>
              </label>
            </div>
          </div>

          <!-- êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒìˆ˜ ë¹„ìœ¨ í•„í„° -->
          <div class="engagement-section">
            <div class="engagement-title">êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒìˆ˜ ë¹„ìœ¨ ë‹¨ê³„(ë‹¤ì¤‘ì„ íƒ)</div>
            <div class="engagement-info">ì¡°íšŒìˆ˜/êµ¬ë…ì ë¹„ìœ¨ì´ ë†’ì„ìˆ˜ë¡ ì±„ë„ì˜ ì‹¤ì œ ì˜í–¥ë ¥ì´ í¼</div>
            <div class="engagement-options">
              <label class="filter-option">
                <input type="checkbox" name="engagementRatio" value="all" />
                <label>ì „ì²´</label>
              </label>
              <label class="filter-option">
                <input type="checkbox" name="engagementRatio" value="1" />
                <label>1ë‹¨ê³„ (<0.2)</label>
              </label>
              <label class="filter-option">
                <input type="checkbox" name="engagementRatio" value="2" />
                <label>2ë‹¨ê³„ (0.2~0.6)</label>
              </label>
              <label class="filter-option">
                <input type="checkbox" name="engagementRatio" value="3" />
                <label>3ë‹¨ê³„ (0.6~1.4)</label>
              </label>
              <label class="filter-option">
                <input type="checkbox" name="engagementRatio" value="4" checked />
                <label>4ë‹¨ê³„ (1.4~3.0)</label>
              </label>
              <label class="filter-option">
                <input type="checkbox" name="engagementRatio" value="5" checked />
                <label>5ë‹¨ê³„ (â‰¥3.0)</label>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ì»¨í…ì¸  ì˜ì—­ -->
      <div class="content">
        <div class="content-header">
          <div class="content-title">ê²€ìƒ‰ê²°ê³¼</div>
          <div class="controls-right">
            <div class="view-toggle">
              <button class="view-btn active" id="btnCardView" data-view="card">ğŸ“‡ ì¹´ë“œ</button>
              <button class="view-btn" id="btnTableView" data-view="table">ğŸ“Š í…Œì´ë¸”</button>
            </div>
            <select class="sort-dropdown" id="sortDropdown">
              <option value="relevance">ì¡°íšŒìˆ˜ + ë‚´ë¦¼ì°¨ìˆœ</option>
              <option value="viewCount">ì¡°íšŒìˆ˜ìˆœ</option>
              <option id="vphSortOption" value="vph" style="display: none;">VPHìˆœ (ë†’ìŒ)</option>
              <option value="engagementRatio">ë¹„ìœ¨ìˆœ (ë†’ìŒ)</option>
              <option value="subscriberCount">êµ¬ë…ììˆœ</option>
              <option value="duration">ê¸¸ì´ìˆœ (ê¸¸ìŒ)</option>
              <option value="likeCount">ì¢‹ì•„ìš”ìˆœ</option>
              <option value="publishedAt">ìµœì‹ ìˆœ</option>
            </select>
            <button class="btn-excel" id="btnExcel">ğŸ“¥ ì—‘ì…€</button>
            <button class="btn-search" id="searchBtn">ê²€ìƒ‰</button>
          </div>
        </div>

        <div id="resultsInfo" class="results-count"></div>
        <div id="statisticsDashboard" class="statistics-dashboard"></div>
        <div id="tagAnalysisDashboard" class="tag-analysis-dashboard"></div>
        <div id="errorContainer"></div>
        <div id="statusContainer" class="status"></div>

        <!-- ì¹´ë“œ ë·° -->
        <div class="results-grid" id="resultsContainer"></div>

        <!-- í…Œì´ë¸” ë·° -->
        <div class="results-table-wrapper" id="tableWrapper">
          <table class="results-table" id="resultsTable">
            <thead>
              <tr>
                <th>ì¸ë„¤ì¼</th>
                <th>ì œëª©</th>
                <th>ì±„ë„ëª…</th>
                <th>ì¡°íšŒìˆ˜</th>
                <th>êµ¬ë…ì</th>
                <th>ë¹„ìœ¨</th>
                <th>ë‹¨ê³„</th>
                <th>ê¸¸ì´</th>
                <th id="vphHeaderCell" style="display: none;">VPH</th>
                <th>ì—…ë¡œë“œ</th>
                <th>ë§í¬</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ëŒ“ê¸€ ë¶„ì„ ëª¨ë‹¬ -->
    <div class="comments-modal" id="commentsModal">
      <div class="comments-modal-content">
        <div class="comments-modal-header">
          <div class="comments-modal-title" id="commentsModalTitle">ëŒ“ê¸€ ë¶„ì„</div>
          <button class="comments-modal-close" id="commentsModalClose">âœ•</button>
        </div>
        <div id="commentsModalBody"></div>
      </div>
    </div>

    <!-- ì±„ë„ ë¶„ì„ ëª¨ë‹¬ -->
    <div class="channel-modal" id="channelModal">
      <div class="channel-modal-content">
        <div class="channel-modal-header">
          <div class="channel-modal-title" id="channelModalTitle">ì±„ë„ ë¶„ì„</div>
          <button class="channel-modal-close" id="channelModalClose">âœ•</button>
        </div>
        <div id="channelModalBody"></div>
      </div>
    </div>

    <script>
      const API_KEY_INPUT = document.getElementById("apiKey");
      const SEARCH_INPUT = document.getElementById("searchInput");
      const SEARCH_BTN = document.getElementById("searchBtn");
      const BTN_SAVE = document.getElementById("btnSave");
      const BTN_DELETE = document.getElementById("btnDelete");
      const BTN_CARD_VIEW = document.getElementById("btnCardView");
      const BTN_TABLE_VIEW = document.getElementById("btnTableView");
      const BTN_EXCEL = document.getElementById("btnExcel");
      const SORT_DROPDOWN = document.getElementById("sortDropdown");
      const RESULTS_CONTAINER = document.getElementById("resultsContainer");
      const TABLE_WRAPPER = document.getElementById("tableWrapper");
      const TABLE_BODY = document.getElementById("tableBody");
      const RESULTS_INFO = document.getElementById("resultsInfo");
      const STATUS_CONTAINER = document.getElementById("statusContainer");
      const ERROR_CONTAINER = document.getElementById("errorContainer");
      const SEARCH_HISTORY_DROPDOWN = document.getElementById("searchHistory");
      const STATISTICS_DASHBOARD = document.getElementById("statisticsDashboard");
      const TAG_ANALYSIS_DASHBOARD = document.getElementById("tagAnalysisDashboard");
      const BTN_SAVE_SEARCH = document.getElementById("btnSaveSearch");
      const SAVED_SEARCH_NAME_INPUT = document.getElementById("savedSearchName");
      const SAVED_SEARCHES_LIST = document.getElementById("savedSearchesList");
      const SAVED_SEARCHES_COMPARISON = document.getElementById("savedSearchesComparison");
      const COMMENTS_MODAL = document.getElementById("commentsModal");
      const COMMENTS_MODAL_CLOSE = document.getElementById("commentsModalClose");
      const COMMENTS_MODAL_BODY = document.getElementById("commentsModalBody");
      const COMMENTS_MODAL_TITLE = document.getElementById("commentsModalTitle");
      const CHANNEL_MODAL = document.getElementById("channelModal");
      const CHANNEL_MODAL_CLOSE = document.getElementById("channelModalClose");
      const CHANNEL_MODAL_BODY = document.getElementById("channelModalBody");
      const CHANNEL_MODAL_TITLE = document.getElementById("channelModalTitle");
      const SHOW_VPH_CHECKBOX = document.getElementById("showVPH");
      const VPH_HEADER_CELL = document.getElementById("vphHeaderCell");
      const VPH_SORT_OPTION = document.getElementById("vphSortOption");

      const YOUTUBE_API_URL = "https://www.googleapis.com/youtube/v3";
      const MAX_RESULTS = 30;
      const MAX_HISTORY = 10;
      const MAX_SAVED_SEARCHES = 5;

      let allVideosData = [];
      let allChannelsData = {};
      let currentView = "card";
      let tagAnalysisExpanded = false;
      let currentSearchState = null;
      let currentApiKey = null;
      let showVPH = false;

      // LocalStorage ë¡œë“œ
      function loadFromLocalStorage() {
        const savedKey = localStorage.getItem("yt_api_key");
        const savedQuery = localStorage.getItem("yt_search_query");
        const savedShowVPH = localStorage.getItem("yt_show_vph");
        if (savedKey) API_KEY_INPUT.value = savedKey;
        if (savedQuery) SEARCH_INPUT.value = savedQuery;
        if (savedShowVPH === "true") {
          showVPH = true;
          SHOW_VPH_CHECKBOX.checked = true;
          VPH_HEADER_CELL.style.display = "";
          VPH_SORT_OPTION.style.display = "";
        }
      }

      // ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ í•¨ìˆ˜
      function getSearchHistory() {
        try {
          const history = JSON.parse(localStorage.getItem("yt_search_history") || "[]");
          return Array.isArray(history) ? history : [];
        } catch (error) {
          console.error('ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
          localStorage.removeItem("yt_search_history");
          return [];
        }
      }

      function saveSearchToHistory(query) {
        if (!query.trim()) return;
        let history = getSearchHistory();
        history = history.filter((item) => item !== query);
        history.unshift(query);
        history = history.slice(0, MAX_HISTORY);
        localStorage.setItem("yt_search_history", JSON.stringify(history));
        updateSearchHistory();
      }

      function deleteHistoryItem(query) {
        let history = getSearchHistory();
        history = history.filter((item) => item !== query);
        localStorage.setItem("yt_search_history", JSON.stringify(history));
        updateSearchHistory();
      }

      function updateSearchHistory() {
        const history = getSearchHistory();
        SEARCH_HISTORY_DROPDOWN.innerHTML = "";
        if (history.length === 0) return;

        history.forEach((item) => {
          const historyItem = document.createElement("div");
          historyItem.className = "history-item";
          historyItem.innerHTML = `
                    <span style="cursor: pointer; flex: 1;">${escapeHtml(item)}</span>
                    <button class="history-delete" data-query="${escapeHtml(item)}">âœ•</button>
                `;
          historyItem.querySelector("span").addEventListener("click", () => {
            SEARCH_INPUT.value = item;
            SEARCH_HISTORY_DROPDOWN.classList.remove("active");
          });
          historyItem.querySelector(".history-delete").addEventListener("click", (e) => {
            e.stopPropagation();
            deleteHistoryItem(item);
          });
          SEARCH_HISTORY_DROPDOWN.appendChild(historyItem);
        });
      }

      // ì €ì¥ëœ ê²€ìƒ‰ í•¨ìˆ˜
      function getSavedSearches() {
        try {
          const searches = JSON.parse(localStorage.getItem("yt_saved_searches") || "[]");
          return Array.isArray(searches) ? searches : [];
        } catch (error) {
          console.error('ì €ì¥ëœ ê²€ìƒ‰ ë¡œë“œ ì‹¤íŒ¨:', error);
          localStorage.removeItem("yt_saved_searches");
          return [];
        }
      }

      function saveCurentSearch(name) {
        if (!name.trim()) {
          alert("ê²€ìƒ‰ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
          return;
        }

        const uploadPeriod = document.querySelector('input[name="uploadPeriod"]:checked').value;
        const videoLength = document.querySelector('input[name="videoLength"]:checked').value;
        const engagementRatios = Array.from(document.querySelectorAll('input[name="engagementRatio"]:checked')).map((el) => el.value);

        const searchData = {
          id: Date.now().toString(),
          name: name,
          query: SEARCH_INPUT.value,
          uploadPeriod: uploadPeriod,
          videoLength: videoLength,
          engagementRatios: engagementRatios,
          timestamp: new Date().toISOString(),
          resultCount: allVideosData.length,
          stats: calculateStatistics(allVideosData),
        };

        let searches = getSavedSearches();
        searches.unshift(searchData);
        searches = searches.slice(0, MAX_SAVED_SEARCHES);
        localStorage.setItem("yt_saved_searches", JSON.stringify(searches));
        updateSavedSearchesList();
        SAVED_SEARCH_NAME_INPUT.value = "";
        alert("ê²€ìƒ‰ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤");
      }

      function deleteSavedSearch(id) {
        let searches = getSavedSearches();
        searches = searches.filter((s) => s.id !== id);
        localStorage.setItem("yt_saved_searches", JSON.stringify(searches));
        updateSavedSearchesList();
      }

      function loadSavedSearch(id) {
        const searches = getSavedSearches();
        const search = searches.find((s) => s.id === id);
        if (!search) return;

        SEARCH_INPUT.value = search.query;

        // í•„í„° ë³µì›
        document.querySelector(`input[name="uploadPeriod"][value="${search.uploadPeriod}"]`).checked = true;
        document.querySelector(`input[name="videoLength"][value="${search.videoLength}"]`).checked = true;

        document.querySelectorAll('input[name="engagementRatio"]').forEach((el) => {
          el.checked = search.engagementRatios.includes(el.value);
        });

        handleSearch();
      }

      function updateSavedSearchesList() {
        const searches = getSavedSearches();
        SAVED_SEARCHES_LIST.innerHTML = "";

        if (searches.length === 0) {
          SAVED_SEARCHES_LIST.innerHTML = '<div style="color: #999; font-size: 12px;">ì €ì¥ëœ ê²€ìƒ‰ì´ ì—†ìŠµë‹ˆë‹¤</div>';
          return;
        }

        searches.forEach((search) => {
          const item = document.createElement("div");
          item.className = "saved-search-item";
          item.innerHTML = `
                    <span class="saved-search-item-name">${escapeHtml(search.name)}</span>
                    <button class="saved-search-item-delete" data-id="${search.id}">âœ•</button>
                `;

          item.querySelector(".saved-search-item-name").addEventListener("click", () => {
            loadSavedSearch(search.id);
          });

          item.querySelector(".saved-search-item-delete").addEventListener("click", (e) => {
            e.stopPropagation();
            if (confirm("ê²€ìƒ‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              deleteSavedSearch(search.id);
            }
          });

          SAVED_SEARCHES_LIST.appendChild(item);
        });
      }

      // ëŒ“ê¸€ ë¶„ì„ í•¨ìˆ˜
      async function fetchAndDisplayComments(videoId, videoTitle, apiKey) {
        COMMENTS_MODAL_TITLE.textContent = `ğŸ“¬ ${escapeHtml(videoTitle.substring(0, 30))}... ëŒ“ê¸€ ë¶„ì„`;
        COMMENTS_MODAL_BODY.innerHTML = '<div class="comments-loading">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
        COMMENTS_MODAL.classList.add("active");

        try {
          const response = await fetch(
            `${YOUTUBE_API_URL}/commentThreads?part=snippet&videoId=${videoId}&maxResults=100&textFormat=plainText&key=${apiKey}`
          );

          if (!response.ok) {
            throw new Error("ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
          }

          const data = await response.json();
          const comments = data.items || [];

          if (comments.length === 0) {
            COMMENTS_MODAL_BODY.innerHTML = '<div style="color: #999; padding: 20px; text-align: center;">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
          }

          // ëŒ“ê¸€ í†µê³„ ê³„ì‚°
          let totalReplies = 0;
          let totalLikes = 0;
          comments.forEach((thread) => {
            const snippet = thread.snippet;
            totalReplies += snippet.totalReplyCount || 0;
            totalLikes += snippet.topLevelComment.snippet.likeCount || 0;
          });

          const html = `
                    <div class="comments-stats">
                        <div class="comment-stat-item">
                            <div class="comment-stat-label">ì´ ëŒ“ê¸€</div>
                            <div class="comment-stat-value">${comments.length}</div>
                        </div>
                        <div class="comment-stat-item">
                            <div class="comment-stat-label">ì´ ë‹µê¸€</div>
                            <div class="comment-stat-value">${totalReplies}</div>
                        </div>
                        <div class="comment-stat-item">
                            <div class="comment-stat-label">ì´ ì¢‹ì•„ìš”</div>
                            <div class="comment-stat-value">${totalLikes}</div>
                        </div>
                        <div class="comment-stat-item">
                            <div class="comment-stat-label">í‰ê·  ì¢‹ì•„ìš”</div>
                            <div class="comment-stat-value">${Math.round(totalLikes / comments.length)}</div>
                        </div>
                    </div>
                    <div class="comments-list">
                        ${comments
                          .slice(0, 20)
                          .map((thread) => {
                            const comment = thread.snippet.topLevelComment.snippet;
                            return `
                                <div class="comment-item">
                                    <div class="comment-author">${escapeHtml(comment.authorDisplayName)}</div>
                                    <div class="comment-text">${escapeHtml(comment.textDisplay)}</div>
                                    <div class="comment-meta">
                                        <span class="comment-likes">ğŸ‘ ${comment.likeCount}</span>
                                        ${
                                          thread.snippet.totalReplyCount > 0
                                            ? `<span class="comment-replies">ğŸ’¬ ${thread.snippet.totalReplyCount}ê°œ ë‹µê¸€</span>`
                                            : ""
                                        }
                                    </div>
                                </div>
                            `;
                          })
                          .join("")}
                    </div>
                    <div style="text-align: center; padding: 10px; color: #999; font-size: 11px;">
                        ìƒìœ„ 20ê°œ ëŒ“ê¸€ë§Œ í‘œì‹œë©ë‹ˆë‹¤
                    </div>
                `;

          COMMENTS_MODAL_BODY.innerHTML = html;
        } catch (error) {
          COMMENTS_MODAL_BODY.innerHTML = `<div style="color: #f44336; padding: 20px;">ì˜¤ë¥˜: ${error.message}</div>`;
        }
      }

      // ëª¨ë‹¬ ë‹«ê¸°
      COMMENTS_MODAL_CLOSE.addEventListener("click", () => {
        COMMENTS_MODAL.classList.remove("active");
      });

      COMMENTS_MODAL.addEventListener("click", (e) => {
        if (e.target === COMMENTS_MODAL) {
          COMMENTS_MODAL.classList.remove("active");
        }
      });

      // ì±„ë„ ë¶„ì„ í•¨ìˆ˜
      async function fetchAndDisplayChannelAnalysis(channelId, channelTitle, apiKey) {
        CHANNEL_MODAL_TITLE.textContent = `ğŸ“º ${escapeHtml(channelTitle)} ì±„ë„ ë¶„ì„`;
        CHANNEL_MODAL_BODY.innerHTML = '<div class="channel-loading">ì±„ë„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
        CHANNEL_MODAL.classList.add("active");

        try {
          const response = await fetch(
            `${YOUTUBE_API_URL}/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${apiKey}`
          );

          if (!response.ok) {
            throw new Error("ì±„ë„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
          }

          const data = await response.json();
          const channel = data.items[0];

          if (!channel) {
            CHANNEL_MODAL_BODY.innerHTML =
              '<div style="color: #999; padding: 20px; text-align: center;">ì±„ë„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
          }

          const stats = channel.statistics;
          const snippet = channel.snippet;
          const description = snippet.description || "ì„¤ëª… ì—†ìŒ";

          const html = `
                    <div class="channel-description">
                        ${escapeHtml(description.substring(0, 300))}${description.length > 300 ? "..." : ""}
                    </div>
                    <div class="channel-stats-grid">
                        <div class="channel-stat-box">
                            <div class="channel-stat-label">ì´ ì¡°íšŒìˆ˜</div>
                            <div class="channel-stat-value">${formatNumber(parseInt(stats.viewCount) || 0)}</div>
                        </div>
                        <div class="channel-stat-box">
                            <div class="channel-stat-label">êµ¬ë…ì ìˆ˜</div>
                            <div class="channel-stat-value">${
                              stats.hiddenSubscriberCount ? "ë¹„ê³µê°œ" : formatNumber(parseInt(stats.subscriberCount) || 0)
                            }</div>
                        </div>
                        <div class="channel-stat-box">
                            <div class="channel-stat-label">ì´ ì˜ìƒ ìˆ˜</div>
                            <div class="channel-stat-value">${formatNumber(parseInt(stats.videoCount) || 0)}</div>
                        </div>
                        <div class="channel-stat-box">
                            <div class="channel-stat-label">ì±„ë„ ì¹´í…Œê³ ë¦¬</div>
                            <div class="channel-stat-value">${snippet.customUrl || "N/A"}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="https://www.youtube.com/channel/${channelId}" target="_blank" style="display: inline-block; padding: 10px 20px; background-color: #ff0000; color: white; text-decoration: none; border-radius: 4px; font-weight: 600;">YouTube ì±„ë„ ë°©ë¬¸</a>
                    </div>
                `;

          CHANNEL_MODAL_BODY.innerHTML = html;
        } catch (error) {
          CHANNEL_MODAL_BODY.innerHTML = `<div style="color: #f44336; padding: 20px;">ì˜¤ë¥˜: ${error.message}</div>`;
        }
      }

      // ì±„ë„ ëª¨ë‹¬ ë‹«ê¸°
      CHANNEL_MODAL_CLOSE.addEventListener("click", () => {
        CHANNEL_MODAL.classList.remove("active");
      });

      CHANNEL_MODAL.addEventListener("click", (e) => {
        if (e.target === CHANNEL_MODAL) {
          CHANNEL_MODAL.classList.remove("active");
        }
      });

      loadFromLocalStorage();
      updateSearchHistory();
      updateSavedSearchesList();

      // ë·° ì „í™˜
      BTN_CARD_VIEW.addEventListener("click", () => {
        currentView = "card";
        BTN_CARD_VIEW.classList.add("active");
        BTN_TABLE_VIEW.classList.remove("active");
        RESULTS_CONTAINER.classList.remove("hidden");
        TABLE_WRAPPER.classList.remove("active");
      });

      BTN_TABLE_VIEW.addEventListener("click", () => {
        currentView = "table";
        BTN_TABLE_VIEW.classList.add("active");
        BTN_CARD_VIEW.classList.remove("active");
        RESULTS_CONTAINER.classList.add("hidden");
        TABLE_WRAPPER.classList.add("active");
      });

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      SEARCH_BTN.addEventListener("click", handleSearch);
      BTN_SAVE.addEventListener("click", saveSettings);
      BTN_DELETE.addEventListener("click", deleteSettings);
      BTN_EXCEL.addEventListener("click", downloadExcel);
      SEARCH_INPUT.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          saveSearchToHistory(SEARCH_INPUT.value);
          handleSearch();
        }
      });
      SEARCH_INPUT.addEventListener("focus", () => {
        if (getSearchHistory().length > 0) {
          SEARCH_HISTORY_DROPDOWN.classList.add("active");
        }
      });
      SEARCH_INPUT.addEventListener("blur", () => {
        setTimeout(() => SEARCH_HISTORY_DROPDOWN.classList.remove("active"), 200);
      });
      SORT_DROPDOWN.addEventListener("change", refilterResults);
      BTN_SAVE_SEARCH.addEventListener("click", () => {
        if (allVideosData.length === 0) {
          alert("ë¨¼ì € ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ì„¸ìš”");
          return;
        }
        saveCurentSearch(SAVED_SEARCH_NAME_INPUT.value);
      });

      // VPH ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
      SHOW_VPH_CHECKBOX.addEventListener("change", () => {
        showVPH = SHOW_VPH_CHECKBOX.checked;
        localStorage.setItem("yt_show_vph", showVPH);

        // VPH í—¤ë” í‘œì‹œ/ìˆ¨ê¹€
        VPH_HEADER_CELL.style.display = showVPH ? "" : "none";
        // VPH ì •ë ¬ ì˜µì…˜ í‘œì‹œ/ìˆ¨ê¹€
        VPH_SORT_OPTION.style.display = showVPH ? "" : "none";

        // í˜„ì¬ ì •ë ¬ì´ VPHì¸ë° VPHë¥¼ í•´ì œí•˜ë©´ ê¸°ë³¸ ì •ë ¬ë¡œ ë³€ê²½
        if (!showVPH && SORT_DROPDOWN.value === "vph") {
          SORT_DROPDOWN.value = "relevance";
        }

        // ê²°ê³¼ ë‹¤ì‹œ ë Œë”ë§
        refilterResults();
      });

      // í•„í„° ë³€ê²½ ì‹œ ìë™ ì¬í•„í„°ë§
      document.querySelectorAll('input[name="uploadPeriod"], input[name="videoLength"], input[name="engagementRatio"]').forEach((input) => {
        input.addEventListener("change", refilterResults);
      });

      function saveSettings() {
        localStorage.setItem("yt_api_key", API_KEY_INPUT.value);
        localStorage.setItem("yt_search_query", SEARCH_INPUT.value);
        alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤");
      }

      function deleteSettings() {
        localStorage.removeItem("yt_api_key");
        localStorage.removeItem("yt_search_query");
        API_KEY_INPUT.value = "";
        SEARCH_INPUT.value = "";
        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤");
      }

      async function handleSearch() {
        const searchQuery = SEARCH_INPUT.value.trim();
        const apiKey = API_KEY_INPUT.value.trim();

        if (!searchQuery) {
          showError("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
          return;
        }

        if (!apiKey) {
          showError("API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
          return;
        }

        saveSearchToHistory(searchQuery);
        await searchVideos(searchQuery, apiKey);
      }

      async function searchVideos(query, apiKey) {
        try {
          setStatus("ê²€ìƒ‰ ì¤‘...");
          SEARCH_BTN.disabled = true;
          clearResults();
          clearError();

          const searchResponse = await fetch(
            `${YOUTUBE_API_URL}/search?part=snippet&q=${encodeURIComponent(query)}&maxResults=${MAX_RESULTS}&type=video&key=${apiKey}`
          );

          if (!searchResponse.ok) {
            const errorData = await searchResponse.json().catch(() => ({}));
            const errorMessage = errorData.error?.message || 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ';

            if (searchResponse.status === 403) {
              throw new Error('âŒ API í‚¤ ê¶Œí•œ ë¬¸ì œ: ' + errorMessage + ' (í• ë‹¹ëŸ‰ ì´ˆê³¼ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)');
            } else if (searchResponse.status === 400) {
              throw new Error('âŒ ì˜ëª»ëœ ìš”ì²­: ' + errorMessage);
            } else if (searchResponse.status === 429) {
              throw new Error('â±ï¸ API ìš”ì²­ í•œë„ ì´ˆê³¼: ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”');
            }
            throw new Error('âŒ ' + errorMessage);
          }

          const searchData = await searchResponse.json();

          if (!searchData?.items || !Array.isArray(searchData.items) || searchData.items.length === 0) {
            showNoResults("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤");
            return;
          }

          // videoId í•„í„°ë§ ë° ê²€ì¦
          const videoIds = searchData.items
            .map((item) => item?.id?.videoId)
            .filter(id => id && typeof id === 'string')
            .join(",");

          if (!videoIds) {
            showNoResults("ìœ íš¨í•œ ì˜ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
            return;
          }
          setStatus("ì˜ìƒ ì •ë³´ ì¡°íšŒ ì¤‘...");

          const detailsResponse = await fetch(
            `${YOUTUBE_API_URL}/videos?part=snippet,statistics,contentDetails&id=${videoIds}&key=${apiKey}`
          );

          if (!detailsResponse.ok) {
            const errorData = await detailsResponse.json().catch(() => ({}));
            throw new Error("âŒ ì˜ìƒ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: " + (errorData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
          }

          const detailsData = await detailsResponse.json();
          if (!detailsData?.items || !Array.isArray(detailsData.items)) {
            throw new Error("âŒ ì˜ìƒ ì •ë³´ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤");
          }

          // ë°ì´í„° ê²€ì¦ í•„í„°ë§
          allVideosData = detailsData.items.filter(item =>
            item?.id && item?.snippet && item?.statistics && item?.contentDetails
          );

          if (allVideosData.length === 0) {
            showNoResults("ìœ íš¨í•œ ì˜ìƒ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
            return;
          }

          setStatus("ì±„ë„ ì •ë³´ ì¡°íšŒ ì¤‘...");

          const channelIds = [...new Set(allVideosData.map((video) => video?.snippet?.channelId).filter(Boolean))];
          allChannelsData = {};

          for (let i = 0; i < channelIds.length; i += 50) {
            try {
              const chunk = channelIds.slice(i, i + 50).join(",");
              const progress = Math.round((i / channelIds.length) * 100);
              setStatus(`ì±„ë„ ì •ë³´ ì¡°íšŒ ì¤‘... ${progress}%`);

              const channelResponse = await fetch(`${YOUTUBE_API_URL}/channels?part=statistics&id=${chunk}&key=${apiKey}`);

              if (channelResponse.ok) {
                const channelData = await channelResponse.json();
                channelData.items?.forEach((channel) => {
                  if (channel?.id && channel?.statistics) {
                    allChannelsData[channel.id] = channel.statistics;
                  }
                });
              } else {
                console.warn(`ì±„ë„ ì •ë³´ ì¡°íšŒ ë¶€ë¶„ ì‹¤íŒ¨ (${i}-${i+50})`);
                // ì¼ë¶€ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
              }
            } catch (err) {
              console.warn(`ì±„ë„ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ (${i}-${i+50}):`, err);
              // ì¼ë¶€ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
            }
          }

          refilterResults();
          setStatus("");
        } catch (error) {
          console.error("ì—ëŸ¬:", error);
          showError(error.message || "ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
          setStatus("");
        } finally {
          SEARCH_BTN.disabled = false;
        }
      }

      function refilterResults() {
        if (allVideosData.length === 0) {
          return;
        }

        const uploadPeriod = document.querySelector('input[name="uploadPeriod"]:checked').value;
        const videoLength = document.querySelector('input[name="videoLength"]:checked').value;
        const engagementRatios = Array.from(document.querySelectorAll('input[name="engagementRatio"]:checked')).map((el) => el.value);

        let filtered = allVideosData.filter((video) => {
          if (videoLength !== "all") {
            const duration = parseDuration(video.contentDetails.duration);
            if (videoLength === "short" && duration > 180) return false;
            if (videoLength === "long" && duration <= 180) return false;
          }

          if (uploadPeriod !== "all") {
            const uploadDate = new Date(video.snippet.publishedAt);
            const now = new Date();
            const daysAgo = (now - uploadDate) / (1000 * 60 * 60 * 24);

            if (uploadPeriod === "1month" && daysAgo > 30) return false;
            if (uploadPeriod === "2months" && daysAgo > 60) return false;
            if (uploadPeriod === "6months" && daysAgo > 180) return false;
            if (uploadPeriod === "1year" && daysAgo > 365) return false;
          }

          if (engagementRatios.length > 0 && !engagementRatios.includes("all")) {
            const ratio = calculateEngagementRatio(video);
            const level = getEngagementLevel(ratio);
            if (!engagementRatios.includes(level.toString())) return false;
          }

          return true;
        });

        const sortType = SORT_DROPDOWN.value;
        filtered = sortResults(filtered, sortType);

        displayResults(filtered, uploadPeriod, videoLength, engagementRatios);
      }

      function sortResults(videos, sortType) {
        const sorted = [...videos];
        switch (sortType) {
          case "viewCount":
            sorted.sort((a, b) => parseInt(b.statistics.viewCount) - parseInt(a.statistics.viewCount));
            break;
          case "vph":
            sorted.sort((a, b) => {
              const vphA = calculateVPH(parseInt(a.statistics.viewCount) || 0, a.snippet.publishedAt);
              const vphB = calculateVPH(parseInt(b.statistics.viewCount) || 0, b.snippet.publishedAt);
              return vphB - vphA;
            });
            break;
          case "engagementRatio":
            sorted.sort((a, b) => {
              const ratioA = calculateEngagementRatio(a);
              const ratioB = calculateEngagementRatio(b);
              return ratioB - ratioA;
            });
            break;
          case "subscriberCount":
            sorted.sort((a, b) => {
              const subA = allChannelsData[a.snippet.channelId] ? parseInt(allChannelsData[a.snippet.channelId].subscriberCount) || 0 : 0;
              const subB = allChannelsData[b.snippet.channelId] ? parseInt(allChannelsData[b.snippet.channelId].subscriberCount) || 0 : 0;
              return subB - subA;
            });
            break;
          case "duration":
            sorted.sort((a, b) => {
              const durationA = parseDuration(a.contentDetails.duration);
              const durationB = parseDuration(b.contentDetails.duration);
              return durationB - durationA;
            });
            break;
          case "likeCount":
            sorted.sort((a, b) => {
              const likesA = parseInt(a.statistics.likeCount) || 0;
              const likesB = parseInt(b.statistics.likeCount) || 0;
              return likesB - likesA;
            });
            break;
          case "publishedAt":
            sorted.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
            break;
          case "relevance":
          default:
            sorted.sort((a, b) => {
              const viewA = parseInt(a.statistics.viewCount) || 0;
              const viewB = parseInt(b.statistics.viewCount) || 0;
              return viewB - viewA;
            });
        }
        return sorted;
      }

      function parseDuration(duration) {
        if (!duration) return 0;
        const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
        if (!match) return 0;
        const hours = parseInt(match[1]) || 0;
        const minutes = parseInt(match[2]) || 0;
        const seconds = parseInt(match[3]) || 0;
        return hours * 3600 + minutes * 60 + seconds;
      }

      function calculateEngagementRatio(video) {
        try {
          if (!video || !video.statistics || !video.snippet) return 0;
          const viewCount = parseInt(video.statistics.viewCount) || 0;
          const channelStats = allChannelsData[video.snippet.channelId];
          const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;

          if (subscriberCount === 0) return 0;
          return viewCount / subscriberCount;
        } catch (error) {
          console.error('Engagement ratio ê³„ì‚° ì˜¤ë¥˜:', error);
          return 0;
        }
      }

      function getEngagementLevel(ratio) {
        if (ratio >= 3.0) return 5;
        if (ratio >= 1.4) return 4;
        if (ratio >= 0.6) return 3;
        if (ratio >= 0.2) return 2;
        return 1;
      }

      // ========== IndexedDB VPH ì¶”ì  ì‹œìŠ¤í…œ ==========
      class VPHTracker {
        constructor() {
          this.dbName = 'YouTubeVPHTracker';
          this.dbVersion = 1;
          this.storeName = 'view_history';
          this.db = null;
          this.cache = new Map(); // ë©”ëª¨ë¦¬ ìºì‹œ
          this.pollingInterval = null;
        }

        // DB ì´ˆê¸°í™”
        async init() {
          return new Promise((resolve, reject) => {
            if (this.db) {
              resolve();
              return;
            }

            const request = indexedDB.open(this.dbName, this.dbVersion);

            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
              this.db = request.result;
              this.cleanOldData();
              resolve();
            };

            request.onupgradeneeded = (event) => {
              const db = event.target.result;
              if (!db.objectStoreNames.contains(this.storeName)) {
                const store = db.createObjectStore(this.storeName, { keyPath: 'id', autoIncrement: true });
                store.createIndex('videoId_time', ['videoId', 'timestamp'], { unique: false });
                store.createIndex('videoId', 'videoId', { unique: false });
                store.createIndex('timestamp', 'timestamp', { unique: false });
              }
            };
          });
        }

        // ì¡°íšŒìˆ˜ ê¸°ë¡ ì €ì¥
        async recordViewCount(videoId, viewCount, title, channelId) {
          if (!this.db) return;

          const now = Date.now();
          const record = {
            videoId,
            viewCount,
            title,
            channelId,
            timestamp: now,
          };

          return new Promise((resolve, reject) => {
            try {
              const transaction = this.db.transaction([this.storeName], 'readwrite');
              const store = transaction.objectStore(this.storeName);
              const request = store.add(record);

              request.onerror = () => reject(request.error);
              request.onsuccess = () => {
                // ìºì‹œ ì—…ë°ì´íŠ¸
                this.cache.set(`${videoId}_latest`, record);
                resolve(record);
              };
            } catch (error) {
              reject(error);
            }
          });
        }

        // 24ì‹œê°„ ì „ ë°ì´í„° ì¡°íšŒ
        async getViewCount24hAgo(videoId) {
          if (!this.db) return null;

          const now = Date.now();
          const oneDay = 24 * 60 * 60 * 1000;
          const oneDayAgo = now - oneDay;

          return new Promise((resolve, reject) => {
            try {
              const transaction = this.db.transaction([this.storeName], 'readonly');
              const store = transaction.objectStore(this.storeName);
              const index = store.index('videoId');
              const range = IDBKeyRange.only(videoId);
              const request = index.getAll(range);

              request.onerror = () => reject(request.error);
              request.onsuccess = () => {
                const records = request.result.sort((a, b) => a.timestamp - b.timestamp);

                // 24ì‹œê°„ ì „ ê·¼ì²˜ì˜ ë°ì´í„° ì°¾ê¸°
                const targetRecord = records.find(r => r.timestamp >= oneDayAgo);

                if (!targetRecord) {
                  // ê°€ì¥ ì˜¤ë˜ëœ ë°ì´í„°ê°€ 24ì‹œê°„ ë¯¸ë§Œì´ë©´ null
                  resolve(null);
                } else {
                  resolve(targetRecord);
                }
              };
            } catch (error) {
              reject(error);
            }
          });
        }

        // í˜„ì¬ ì¡°íšŒìˆ˜ ì¡°íšŒ
        async getCurrentViewCount(videoId) {
          if (!this.db) return null;

          return new Promise((resolve, reject) => {
            try {
              const transaction = this.db.transaction([this.storeName], 'readonly');
              const store = transaction.objectStore(this.storeName);
              const index = store.index('videoId');
              const range = IDBKeyRange.only(videoId);
              const request = index.getAll(range);

              request.onerror = () => reject(request.error);
              request.onsuccess = () => {
                const records = request.result;
                if (records.length === 0) {
                  resolve(null);
                } else {
                  // ìµœì‹  ê¸°ë¡ ë°˜í™˜
                  resolve(records[records.length - 1]);
                }
              };
            } catch (error) {
              reject(error);
            }
          });
        }

        // 30ì¼ ì´ìƒ ëœ ë°ì´í„° ì‚­ì œ
        async cleanOldData() {
          if (!this.db) return;

          const now = Date.now();
          const thirtyDays = 30 * 24 * 60 * 60 * 1000;
          const cutoffTime = now - thirtyDays;

          return new Promise((resolve) => {
            try {
              const transaction = this.db.transaction([this.storeName], 'readwrite');
              const store = transaction.objectStore(this.storeName);
              const index = store.index('timestamp');
              const range = IDBKeyRange.upperBound(cutoffTime);
              const request = index.openCursor(range);

              request.onsuccess = (event) => {
                const cursor = event.target.result;
                if (cursor) {
                  store.delete(cursor.primaryKey);
                  cursor.continue();
                } else {
                  resolve();
                }
              };
            } catch (error) {
              resolve();
            }
          });
        }

        // ë°°ì¹˜ ì €ì¥ (ì„±ëŠ¥ ìµœì í™”)
        async batchRecordViewCounts(videoDataArray) {
          if (!this.db || videoDataArray.length === 0) return;

          return Promise.all(
            videoDataArray.map(({ videoId, viewCount, title, channelId }) =>
              this.recordViewCount(videoId, viewCount, title, channelId)
            )
          ).catch(error => console.error('ë°°ì¹˜ ì €ì¥ ì˜¤ë¥˜:', error));
        }
      }

      // ì „ì—­ ì¶”ì  ì‹œìŠ¤í…œ ì¸ìŠ¤í„´ìŠ¤
      const vphTracker = new VPHTracker();

      // ì´ˆê¸°í™”
      vphTracker.init().catch(error => console.warn('VPH ì¶”ì  ì´ˆê¸°í™” ì˜¤ë¥˜:', error));

      // vidIQ ë°©ì‹ì˜ ê°ì‡  ê³„ìˆ˜ ê³„ì‚° (ìµœì¢… ì¡°ì •)
      // vidIQ ì—­ì¶”ë¡  ê¸°ë°˜ ê°ì‡  ê³„ìˆ˜ (ê°•ë ¥í•œ ì‹œê°„ ê°€ì¤‘ì¹˜)
      // ì—­ì¶”ë¡  ë¶„ì„: 2ì¼ ì˜ìƒ (9,900 ì¡°íšŒ) â†’ vidIQ VPH 46
      // ê¸°ë³¸ VPH = 9,900 / 48 = 206.25
      // í•„ìš” ê°ì‡  = 46 / 206.25 = 0.2232 (22.32%)
      function getDecayFactor(daysSinceUpload) {
        if (daysSinceUpload <= 0.2) return 1.0;    // 0-5ì‹œê°„: 100%
        if (daysSinceUpload <= 0.6) return 0.93;   // 5-15ì‹œê°„: 93%
        if (daysSinceUpload <= 1) return 1.0;      // 15-24ì‹œê°„: 100%
        if (daysSinceUpload <= 2) return 0.47;     // 1-2ì¼: 47%
        if (daysSinceUpload <= 3) return 0.26;     // 2-3ì¼: 26%
        if (daysSinceUpload <= 7) return 0.30;     // 3-7ì¼: 30%
        if (daysSinceUpload <= 14) return 0.185;   // 7-14ì¼: 18.5%
        if (daysSinceUpload <= 30) return 0.26;    // 14-30ì¼: 26%
        return 0.11;                                // 30ì¼ ì´ìƒ: 11%
      }

      // ì¶”ì • VPH ê³„ì‚° (ë™ê¸°, ë¹ ë¥¸ ë°˜í™˜) - ì›ë³¸ëŒ€ë¡œ ìˆ«ì ë°˜í™˜ (í˜¸í™˜ì„± ìœ ì§€)
      function calculateVPH(viewCount, publishedAt) {
        try {
          if (!publishedAt) return 0;
          const now = new Date();
          const uploadDate = new Date(publishedAt);
          const hoursElapsed = (now - uploadDate) / (1000 * 60 * 60);
          const daysSinceUpload = hoursElapsed / 24;

          if (hoursElapsed <= 0 || !isFinite(hoursElapsed)) return 0;

          // ê¸°ë³¸ VPH = ì¡°íšŒìˆ˜ / ê²½ê³¼ ì‹œê°„
          const baseVPH = viewCount / hoursElapsed;

          // vidIQ ë°©ì‹: ê°ì‡  ê³„ìˆ˜ ì ìš©ìœ¼ë¡œ ìµœê·¼ íŠ¸ë Œë“œ ë°˜ì˜
          const decayFactor = getDecayFactor(daysSinceUpload);
          const adjustedVPH = baseVPH * decayFactor;

          return isFinite(adjustedVPH) ? Math.round(adjustedVPH) : 0;
        } catch (error) {
          console.error('VPH ê³„ì‚° ì˜¤ë¥˜:', error);
          return 0;
        }
      }

      // ì •í™•í•œ VPH ê³„ì‚° (ë¹„ë™ê¸°, ì—­ì‚¬ì  ë°ì´í„° ê¸°ë°˜)
      async function calculateVPHAccurate(videoId, viewCount, publishedAt) {
        try {
          if (!videoId || !publishedAt) {
            return { value: 0, isTrusted: false };
          }

          // í˜„ì¬ ì¡°íšŒìˆ˜ì™€ 24ì‹œê°„ ì „ ì¡°íšŒìˆ˜ ë¹„êµ
          const record24hAgo = await vphTracker.getViewCount24hAgo(videoId);

          if (record24hAgo && record24hAgo.viewCount > 0) {
            // 24ì‹œê°„ ë‚´ ì¦ê°€í•œ ì¡°íšŒìˆ˜
            const recentViewIncrease = viewCount - record24hAgo.viewCount;

            if (recentViewIncrease >= 0) {
              // ì‹¤ì œ VPH = ìµœê·¼ 24ì‹œê°„ ì¦ê°€ / 24
              const accurateVPH = Math.round(recentViewIncrease / 24);

              // ì‹ ë¢°ë„ ì ìˆ˜: ë°ì´í„° ë‚˜ì´ì— ë”°ë¼ ì¡°ì •
              const now = Date.now();
              const dataAge = (now - record24hAgo.timestamp) / (60 * 60 * 1000); // ì‹œê°„ ë‹¨ìœ„
              const confidence = Math.min(100, Math.max(80, 100 - (dataAge - 24) * 5)); // 24h ì´ìƒ ì°¨ì´ë‚˜ë©´ ê°ì†Œ

              return {
                value: accurateVPH,
                isTrusted: true,
                source: 'tracked',
                confidence: Math.round(confidence),
                dataAgeHours: Math.round(dataAge * 10) / 10
              };
            }
          }

          // 24ì‹œê°„ ë°ì´í„° ì—†ìœ¼ë©´ ì¶”ì •ì¹˜ ë°˜í™˜
          const estimated = calculateVPH(viewCount, publishedAt);
          return {
            ...estimated,
            source: 'estimated_no_history'
          };
        } catch (error) {
          console.error('ì •í™•í•œ VPH ê³„ì‚° ì˜¤ë¥˜:', error);
          const fallback = calculateVPH(viewCount, publishedAt);
          return { ...fallback, source: 'error' };
        }
      }

      function calculateStatistics(videos) {
        if (videos.length === 0) return null;

        let totalViews = 0;
        let totalSubscribers = 0;
        let totalRatio = 0;
        let ratioCount = 0;
        let totalVPH = 0;

        videos.forEach((video) => {
          const viewCount = parseInt(video.statistics.viewCount) || 0;
          const channelStats = allChannelsData[video.snippet.channelId];
          const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
          const vph = calculateVPH(viewCount, video.snippet.publishedAt);

          totalViews += viewCount;
          totalVPH += vph;
          if (subscriberCount > 0) {
            totalSubscribers += subscriberCount;
            totalRatio += viewCount / subscriberCount;
            ratioCount++;
          }
        });

        return {
          avgViews: Math.round(totalViews / videos.length),
          avgSubscribers: Math.round(totalSubscribers / videos.length),
          avgRatio: ratioCount > 0 ? (totalRatio / ratioCount).toFixed(2) : 0,
          avgVPH: Math.round(totalVPH / videos.length),
          totalCount: videos.length,
        };
      }

      function displayStatistics(videos) {
        const stats = calculateStatistics(videos);
        if (!stats) {
          STATISTICS_DASHBOARD.innerHTML = "";
          return;
        }

        STATISTICS_DASHBOARD.innerHTML = `
                <div class="stat-card count">
                    <div class="stat-label">ì´ ì˜ìƒ</div>
                    <div class="stat-value">${stats.totalCount}</div>
                </div>
                <div class="stat-card views">
                    <div class="stat-label">í‰ê·  ì¡°íšŒìˆ˜</div>
                    <div class="stat-value">${formatNumber(stats.avgViews)}</div>
                </div>
                <div class="stat-card subscribers">
                    <div class="stat-label">í‰ê·  êµ¬ë…ì</div>
                    <div class="stat-value">${formatNumber(stats.avgSubscribers)}</div>
                </div>
                <div class="stat-card ratio">
                    <div class="stat-label">í‰ê·  ë¹„ìœ¨</div>
                    <div class="stat-value">${stats.avgRatio}</div>
                </div>
                ${showVPH ? `<div class="stat-card vph">
                    <div class="stat-label">í‰ê·  VPH</div>
                    <div class="stat-value">${formatNumber(stats.avgVPH)}</div>
                </div>` : ''}
            `;
      }

      function analyzeAndDisplayTags(videos) {
        if (videos.length === 0) {
          TAG_ANALYSIS_DASHBOARD.classList.remove("active");
          return;
        }

        // ëª¨ë“  íƒœê·¸ ìˆ˜ì§‘ ë° ë¶„ì„
        const tagMap = {};
        videos.forEach((video) => {
          const tags = video.snippet.tags || [];
          tags.forEach((tag) => {
            if (!tagMap[tag]) {
              tagMap[tag] = {
                tag: tag,
                count: 0,
                totalViews: 0,
                totalSubscribers: 0,
                ratioSum: 0,
                videoCount: 0,
              };
            }
            const viewCount = parseInt(video.statistics.viewCount) || 0;
            const channelStats = allChannelsData[video.snippet.channelId];
            const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;

            tagMap[tag].count++;
            tagMap[tag].totalViews += viewCount;
            tagMap[tag].totalSubscribers += subscriberCount;
            if (subscriberCount > 0) {
              tagMap[tag].ratioSum += viewCount / subscriberCount;
              tagMap[tag].videoCount++;
            }
          });
        });

        // íƒœê·¸ë¥¼ ë¹ˆë„ìˆœìœ¼ë¡œ ì •ë ¬
        const sortedTags = Object.values(tagMap).sort((a, b) => b.count - a.count);
        const topTags = sortedTags.slice(0, 15);

        TAG_ANALYSIS_DASHBOARD.classList.add("active");
        TAG_ANALYSIS_DASHBOARD.innerHTML = `
                <div class="tag-analysis-title">
                    ğŸ“‘ íƒœê·¸ ë¶„ì„ (ì´ ${Object.keys(tagMap).length}ê°œ ê³ ìœ  íƒœê·¸)
                    <button class="tag-analysis-toggle" id="tagToggleBtn">ìƒì„¸ ë³´ê¸°</button>
                </div>
                <div class="tag-cloud" id="tagCloud"></div>
                <div id="tagStatsTable" style="display: none;"></div>
            `;

        // íƒœê·¸ í´ë¼ìš°ë“œ ë Œë”ë§
        const tagCloud = document.getElementById("tagCloud");
        topTags.forEach((tagData) => {
          const maxFreq = topTags[0].count;
          const size = Math.max(12, 14 + (tagData.count / maxFreq) * 6);
          const tagEl = document.createElement("div");
          tagEl.className = "tag-item";
          tagEl.innerHTML = `
                    <span>${escapeHtml(tagData.tag)}</span>
                    <span class="tag-frequency">${tagData.count}</span>
                `;
          tagEl.style.fontSize = size + "px";
          tagEl.addEventListener("click", () => {
            // íƒœê·¸ í´ë¦­ ì‹œ í•„í„°ë§ (ì„ íƒì‚¬í•­)
            console.log("Tag clicked:", tagData.tag);
          });
          tagCloud.appendChild(tagEl);
        });

        // ìƒì„¸ í…Œì´ë¸” ë Œë”ë§
        const statsTable = document.getElementById("tagStatsTable");
        const tableHTML = `
                <table class="tag-stats-table">
                    <thead>
                        <tr>
                            <th>íƒœê·¸</th>
                            <th>ë¹ˆë„</th>
                            <th>í‰ê·  ì¡°íšŒìˆ˜</th>
                            <th>í‰ê·  êµ¬ë…ì</th>
                            <th>í‰ê·  ë¹„ìœ¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${topTags
                          .map(
                            (t) => `
                            <tr>
                                <td><strong>${escapeHtml(t.tag)}</strong></td>
                                <td>${t.count}</td>
                                <td>${formatNumber(Math.round(t.totalViews / t.count))}</td>
                                <td>${formatNumber(Math.round(t.totalSubscribers / t.count))}</td>
                                <td>${t.videoCount > 0 ? (t.ratioSum / t.videoCount).toFixed(2) : "N/A"}</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            `;
        statsTable.innerHTML = tableHTML;

        // í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById("tagToggleBtn").addEventListener("click", function () {
          tagAnalysisExpanded = !tagAnalysisExpanded;
          statsTable.style.display = tagAnalysisExpanded ? "block" : "none";
          this.textContent = tagAnalysisExpanded ? "ê°„ë‹¨íˆ ë³´ê¸°" : "ìƒì„¸ ë³´ê¸°";
        });
      }

      // ì •í™•í•œ VPHë¡œ UI ì—…ë°ì´íŠ¸
      function updateVPHDisplay(videoId, vphResult) {
        if (!vphResult.isTrusted) return;

        const vphValue = vphResult.value;
        const vphText = formatNumber(vphValue);
        const vphLabel = `âš¡ VPH: ${vphText} âœ“`; // ì •í™•í•¨ í‘œì‹œ

        // ê·¸ë¦¬ë“œ ë·° ì—…ë°ì´íŠ¸
        const cards = document.querySelectorAll('[data-video-id]');
        cards.forEach(card => {
          if (card.getAttribute('data-video-id') === videoId) {
            // VPH í•­ëª© ì°¾ê¸°
            const vphElements = card.querySelectorAll('.stat-item');
            vphElements.forEach(el => {
              if (el.textContent.includes('VPH')) {
                // ê¸°ì¡´ í…ìŠ¤íŠ¸ í™•ì¸: "âš¡ VPH: X (ì¶”ì •)"ì—ì„œ "âš¡ VPH: X"ë¡œ ì—…ë°ì´íŠ¸
                el.textContent = vphLabel;
              }
            });
          }
        });

        // í…Œì´ë¸” ë·° ì—…ë°ì´íŠ¸ (ì„ íƒì‚¬í•­)
        // í…Œì´ë¸”ì—ì„œëŠ” videoIdë¥¼ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ìƒëµ
      }

      function displayResults(filtered, uploadPeriod, videoLength, engagementRatios) {
        RESULTS_CONTAINER.innerHTML = "";
        TABLE_BODY.innerHTML = "";

        if (filtered.length === 0) {
          showNoResults("ì¡°ê±´ì— ë§ëŠ” ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤");
          STATISTICS_DASHBOARD.innerHTML = "";
          return;
        }

        // ìë™ ì¶”ì : í˜„ì¬ ì¡°íšŒìˆ˜ ì €ì¥
        const videosToTrack = filtered.map(video => ({
          videoId: video.id,
          viewCount: parseInt(video.statistics.viewCount) || 0,
          title: video.snippet.title,
          channelId: video.snippet.channelId
        }));
        vphTracker.batchRecordViewCounts(videosToTrack).catch(e => console.warn('VPH ì¶”ì  ì €ì¥ ì˜¤ë¥˜:', e));

        showResultsInfo(filtered.length, uploadPeriod, videoLength, engagementRatios);
        displayStatistics(filtered);
        analyzeAndDisplayTags(filtered);

        filtered.forEach((video) => {
          // ì¹´ë“œ ë·°ìš©
          const card = createVideoCard(video);
          RESULTS_CONTAINER.appendChild(card);

          // í…Œì´ë¸” ë·°ìš©
          const row = createTableRow(video);
          TABLE_BODY.appendChild(row);
        });

        // ëŒ“ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll(".btn-view-comments").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            const videoId = btn.getAttribute("data-video-id");
            const title = btn.getAttribute("data-title");
            if (API_KEY_INPUT.value.trim()) {
              fetchAndDisplayComments(videoId, title, API_KEY_INPUT.value.trim());
            } else {
              alert("API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
            }
          });
        });

        // ì±„ë„ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll(".btn-view-channel").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            const channelId = btn.getAttribute("data-channel-id");
            const channelTitle = btn.getAttribute("data-channel-title");
            if (API_KEY_INPUT.value.trim()) {
              fetchAndDisplayChannelAnalysis(channelId, channelTitle, API_KEY_INPUT.value.trim());
            } else {
              alert("API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
            }
          });
        });
      }

      function showResultsInfo(count, uploadPeriod, videoLength, engagementRatios) {
        const texts = [];

        if (videoLength !== "all") {
          texts.push(videoLength === "short" ? "ìˆí¼" : "ë¡±í¼");
        }

        if (uploadPeriod !== "all") {
          const periodMap = {
            "1month": "1ê°œì›”",
            "2months": "2ê°œì›”",
            "6months": "6ê°œì›”",
            "1year": "1ë…„",
          };
          texts.push(periodMap[uploadPeriod] || uploadPeriod);
        }

        const filterText = texts.length > 0 ? ` - ${texts.join(", ")}` : "";
        RESULTS_INFO.textContent = `ê²€ìƒ‰ê²°ê³¼ ${count}ê°œ${filterText}`;
      }

      function createVideoCard(video) {
        const card = document.createElement("div");
        card.className = "video-card";

        const videoId = video.id;
        const snippet = video.snippet;
        const stats = video.statistics;
        const contentDetails = video.contentDetails;

        const title = snippet.title || "ì œëª© ì—†ìŒ";
        const channel = snippet.channelTitle || "ì±„ë„ ì—†ìŒ";
        const thumbnail = snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || "";
        const videoLink = `https://www.youtube.com/watch?v=${videoId}`;
        const tags = snippet.tags ? snippet.tags.slice(0, 2) : [];

        const viewCount = parseInt(stats.viewCount) || 0;
        const channelStats = allChannelsData[snippet.channelId];
        const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
        const engagementRatioValue = calculateEngagementRatio(video);
        const engagementLevel = getEngagementLevel(engagementRatioValue);
        const duration = parseDuration(contentDetails.duration);
        const vph = calculateVPH(viewCount, snippet.publishedAt);

        const viewCountText = formatNumber(viewCount);
        const subscriberText = subscriberCount > 0 ? formatNumber(subscriberCount) : "ë¯¸ê³µê°œ";
        const ratioText = subscriberCount > 0 ? engagementRatioValue.toFixed(2) : "N/A";
        const durationText = formatDuration(duration);
        const vphText = formatNumber(vph);
        const vphLabel = `âš¡ VPH: ${vphText}`;

        let tagsHTML = "";
        if (tags.length > 0) {
          tagsHTML = tags.map((tag) => `<div class="tag">${escapeHtml(tag)}</div>`).join("");
        }

        const badgeClass = `engagement-badge engagement-${engagementLevel}`;

        card.innerHTML = `
                <div style="position: relative;">
                    <img src="${escapeHtml(thumbnail)}" alt="${escapeHtml(title)}" class="video-thumbnail">
                    <div class="video-duration">${durationText}</div>
                </div>
                <div class="video-info">
                    <div class="video-title">${escapeHtml(title)}</div>
                    <div class="video-channel">${escapeHtml(channel)}</div>
                    <div class="video-stats">
                        <div class="stat-item">ğŸ‘ï¸ ${viewCountText}</div>
                        <div class="stat-item">ğŸ“º ${subscriberText}</div>
                    </div>
                    <div class="video-stats">
                        <div class="stat-item">ğŸ“Š ${ratioText}</div>
                        ${showVPH ? `<div class="stat-item">${vphLabel}</div>` : ''}
                    </div>
                    <div class="${badgeClass}">${engagementLevel}ë‹¨ê³„</div>
                    <div class="video-tags">${tagsHTML}</div>
                    <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                        <button class="btn-view-channel" data-channel-id="${snippet.channelId}" data-channel-title="${escapeHtml(
          channel
        )}">ğŸ¥ ì±„ë„</button>
                        <button class="btn-view-comments" data-video-id="${videoId}" data-title="${escapeHtml(title)}">ğŸ’¬ ëŒ“ê¸€</button>
                        <a href="${videoLink}" target="_blank" class="video-link" style="flex: 1; text-align: center; display: flex; align-items: center; justify-content: center;">YouTube â†’</a>
                    </div>
                </div>
            `;

        // ë¹„ë™ê¸° VPH ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ video ID ì†ì„± ì„¤ì •
        card.setAttribute('data-video-id', videoId);

        return card;
      }

      function createTableRow(video) {
        const row = document.createElement("tr");

        const videoId = video.id;
        const snippet = video.snippet;
        const stats = video.statistics;
        const contentDetails = video.contentDetails;

        const title = snippet.title;
        const channel = snippet.channelTitle;
        const thumbnail = snippet.thumbnails.medium.url;
        const videoLink = `https://www.youtube.com/watch?v=${videoId}`;

        const viewCount = parseInt(stats.viewCount) || 0;
        const channelStats = allChannelsData[snippet.channelId];
        const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
        const engagementRatioValue = calculateEngagementRatio(video);
        const engagementLevel = getEngagementLevel(engagementRatioValue);
        const duration = parseDuration(contentDetails.duration);
        const uploadDate = new Date(snippet.publishedAt).toLocaleDateString("ko-KR");
        const vph = calculateVPH(viewCount, snippet.publishedAt);

        const viewCountText = formatNumber(viewCount);
        const subscriberText = subscriberCount > 0 ? formatNumber(subscriberCount) : "ë¯¸ê³µê°œ";
        const ratioText = subscriberCount > 0 ? engagementRatioValue.toFixed(2) : "N/A";
        const durationText = formatDuration(duration);
        const vphText = formatNumber(vph);
        const badgeClass = `engagement-badge engagement-${engagementLevel}`;

        row.innerHTML = `
                <td><img src="${escapeHtml(thumbnail)}" alt="${escapeHtml(title)}" class="table-thumbnail"></td>
                <td class="table-title">${escapeHtml(title)}</td>
                <td>${escapeHtml(channel)}</td>
                <td>${viewCountText}</td>
                <td>${subscriberText}</td>
                <td>${ratioText}</td>
                <td><span class="${badgeClass}">${engagementLevel}ë‹¨ê³„</span></td>
                <td>${durationText}</td>
                ${showVPH ? `<td>${vphText}</td>` : ''}
                <td>${uploadDate}</td>
                <td><a href="${videoLink}" target="_blank" class="table-link">ë³´ê¸°</a></td>
            `;

        return row;
      }

      function downloadExcel() {
        if (allVideosData.length === 0) {
          alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤");
          return;
        }

        // í•„í„°ë§ëœ ë°ì´í„° ì–»ê¸°
        const uploadPeriod = document.querySelector('input[name="uploadPeriod"]:checked').value;
        const videoLength = document.querySelector('input[name="videoLength"]:checked').value;
        const engagementRatios = Array.from(document.querySelectorAll('input[name="engagementRatio"]:checked')).map((el) => el.value);

        let filtered = allVideosData.filter((video) => {
          if (videoLength !== "all") {
            const duration = parseDuration(video.contentDetails.duration);
            if (videoLength === "short" && duration > 180) return false;
            if (videoLength === "long" && duration <= 180) return false;
          }

          if (uploadPeriod !== "all") {
            const uploadDate = new Date(video.snippet.publishedAt);
            const now = new Date();
            const daysAgo = (now - uploadDate) / (1000 * 60 * 60 * 24);

            if (uploadPeriod === "1month" && daysAgo > 30) return false;
            if (uploadPeriod === "2months" && daysAgo > 60) return false;
            if (uploadPeriod === "6months" && daysAgo > 180) return false;
            if (uploadPeriod === "1year" && daysAgo > 365) return false;
          }

          if (engagementRatios.length > 0 && !engagementRatios.includes("all")) {
            const ratio = calculateEngagementRatio(video);
            const level = getEngagementLevel(ratio);
            if (!engagementRatios.includes(level.toString())) return false;
          }

          return true;
        });

        // CSV ë°ì´í„° ìƒì„±
        const csvHeader = ["ì œëª©", "ì±„ë„ëª…", "ì¡°íšŒìˆ˜", "êµ¬ë…ì", "ì¡°íšŒìˆ˜/êµ¬ë…ì", "ë‹¨ê³„", "ì˜ìƒê¸¸ì´", "ì—…ë¡œë“œì¼", "íƒœê·¸", "YouTubeë§í¬"];
        const csvRows = [];

        filtered.forEach((video) => {
          const videoId = video.id;
          const snippet = video.snippet;
          const stats = video.statistics;
          const contentDetails = video.contentDetails;

          const title = snippet.title;
          const channel = snippet.channelTitle;
          const tags = snippet.tags ? snippet.tags.join(";") : "";
          const videoLink = `https://www.youtube.com/watch?v=${videoId}`;

          const viewCount = parseInt(stats.viewCount) || 0;
          const channelStats = allChannelsData[snippet.channelId];
          const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
          const engagementRatioValue = calculateEngagementRatio(video);
          const engagementLevel = getEngagementLevel(engagementRatioValue);
          const duration = parseDuration(contentDetails.duration);
          const uploadDate = new Date(snippet.publishedAt).toLocaleDateString("ko-KR");
          const durationText = formatDuration(duration);

          const ratioText = subscriberCount > 0 ? engagementRatioValue.toFixed(2) : "N/A";

          csvRows.push([
            `"${title.replace(/"/g, '""')}"`,
            `"${channel.replace(/"/g, '""')}"`,
            viewCount,
            subscriberCount,
            ratioText,
            engagementLevel,
            durationText,
            uploadDate,
            `"${tags.replace(/"/g, '""')}"`,
            videoLink,
          ]);
        });

        // CSV ë¬¸ìì—´ ìƒì„±
        const csv = [csvHeader.join(","), ...csvRows.map((row) => row.join(","))].join("\n");

        // ë‹¤ìš´ë¡œë“œ
        const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `youtube-search-${new Date().toISOString().split("T")[0]}.csv`);
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function formatNumber(num) {
        try {
          if (typeof num !== 'number') {
            num = parseInt(num) || 0;
          }
          if (!isFinite(num)) return "0";

          num = Math.abs(Math.floor(num)); // ìŒìˆ˜ ë°©ì§€, ì •ìˆ˜ ì²˜ë¦¬

          if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + "M";
          } else if (num >= 1000) {
            return (num / 1000).toFixed(1) + "K";
          }
          return num.toString();
        } catch (error) {
          console.error('ìˆ«ì í¬ë§·íŒ… ì˜¤ë¥˜:', error);
          return "0";
        }
      }

      function formatDuration(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;

        if (hours > 0) {
          return `${hours}:${String(minutes).padStart(2, "0")}:${String(secs).padStart(2, "0")}`;
        }
        return `${minutes}:${String(secs).padStart(2, "0")}`;
      }

      function escapeHtml(text) {
        try {
          if (text == null) return '';
          if (typeof text !== 'string') text = String(text);

          const map = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#039;",
          };
          return text.replace(/[&<>"']/g, (m) => map[m]);
        } catch (error) {
          console.error('HTML escape ì˜¤ë¥˜:', error);
          return '';
        }
      }

      function setStatus(message) {
        STATUS_CONTAINER.innerHTML = message ? `<div class="loading-spinner"></div> ${message}` : "";
      }

      function showError(message) {
        ERROR_CONTAINER.innerHTML = `<div class="error-message">âš ï¸ ${message}</div>`;
      }

      function clearError() {
        ERROR_CONTAINER.innerHTML = "";
      }

      function clearResults() {
        RESULTS_CONTAINER.innerHTML = "";
        TABLE_BODY.innerHTML = "";
        RESULTS_INFO.textContent = "";
      }

      function showNoResults(message) {
        RESULTS_CONTAINER.innerHTML = `<div class="no-results">${message}</div>`;
        RESULTS_INFO.textContent = "";
      }

      SEARCH_INPUT.focus();
    </script>
  </body>
</html>
